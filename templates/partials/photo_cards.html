{% macro photo_card(p) %}
  <article class="lp-card glass p-0 mb-4 fade-up">
    {% if p.images|length %}
      <img class="lp-photo" src="{{ p.images[0].url }}" alt="photo">
    {% endif %}

    <div class="lp-body">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="badge text-bg-dark rounded-pill px-3 py-2">
          <i class="bi bi-images me-1"></i> {{ p.image_count }} صورة
        </span>
        <a class="text-decoration-none text-muted" href="{{ url_for('profile', username=p.author.username) }}">
          <img src="{{ p.author.avatar_url }}" class="lp-avatar-xs gold-ring me-1">
          {{ p.author.display_name or p.author.username }}
        </a>
      </div>

      {% if p.caption %}
        <p class="mb-2">{{ p.caption|e }}</p>
      {% endif %}

      <div class="lp-actions">
        {% if current_user.is_authenticated and p.user_id == current_user.id %}
          <form class="me-auto" action="{{ url_for('post_delete', pid=p.id) }}" method="post"
                onsubmit="return confirm('حذف المنشور نهائيًا؟');">
            <button class="btn btn-glass text-danger"><i class="bi bi-trash"></i></button>
          </form>
        {% endif %}

        {% set liked = p.is_liked_by(current_user) %}
        <a href="#" class="btn {{ 'btn-gold' if liked else 'btn-glass' }}" data-like="{{ p.id }}">
          <i class="bi bi-heart{{ '' if liked else '-pulse' }} me-1"></i>
          <span data-like-count>{{ p.like_count }}</span>
        </a>

        {% set saved = p.is_bookmarked_by(current_user) %}
        <a href="#" class="btn {{ 'btn-gold' if saved else 'btn-glass' }}" data-save="{{ p.id }}">
          <i class="bi bi-bookmark-heart"></i>
        </a>

        {% if p.allow_share %}
          <a class="btn btn-glass" href="{{ p.images[0].url }}" download><i class="bi bi-share"></i></a>
        {% endif %}
      </div>

      {# ===== التعليقات: إدراج الجزء الزجاجي الجاهز ===== #}
      <div class="mt-3">
        {% set post = p %}
        {% include "partials/comments.html" %}
      </div>
    </div>
  </article>
{% endmacro %}