<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>بروفايل @{{ user.username }} - لاند فوتو</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    :root{--bg:#0b0b12;--ink:#f6f6f6;--muted:#bfc4d0;--card:#131422;--chip:#1b1d2e;--accent:#ffd60a}
    body{background:linear-gradient(135deg,#0b0b12,#12122a 50%,#0b0b12);color:var(--ink);font-family:'Cairo',sans-serif}
    .page-wrap{max-width:1050px;margin:28px auto;padding:0 16px}

    .profile-header{
      background: radial-gradient(900px 380px at 110% -30%, rgba(160,107,255,.25) 0, transparent 60%),
                  radial-gradient(800px 380px at -10% -40%, rgba(255,214,10,.22) 0, transparent 58%),
                  linear-gradient(180deg,#17172a,#121325 70%);
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      box-shadow:0 10px 26px rgba(0,0,0,.35);
    }
    .avatar{
      width:108px;height:108px;object-fit:cover;border-radius:50%;
      border:3px solid rgba(255,255,255,.25);
      box-shadow:0 0 0 6px rgba(255,214,10,.15), 0 8px 24px rgba(0,0,0,.45);
      background:#222
    }

    /* نفس ستايل الإعدادات */
    .display-name{font-weight:800;font-size:1.75rem;letter-spacing:.2px}
    .username-badge{
      display:inline-flex;align-items:center;gap:.35rem;
      padding:.25rem .6rem;border-radius:999px;
      border:1px solid #ffffff20;background:rgba(255,255,255,.06);
      font-weight:700;font-size:.95rem;color:#cbd5e1
    }

    .chip{background:var(--chip);color:var(--ink);border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:12px;display:flex;align-items:center;gap:.45rem}
    .btn-accent{background:var(--accent);color:#000;font-weight:800;border:none}
    .btn-accent:hover{background:#ffc800}
    .photo-card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.35)}
    .photo-card img{display:block;width:100%}
    .photo-desc{color:#eaeaea;opacity:.95}
    .muted{color:var(--muted)}
    .section-title{color:var(--accent);font-weight:800}
  </style>
</head>
<body>
  <div class="page-wrap">

    <div class="d-flex justify-content-between align-items-center mb-3">
      <a class="btn btn-accent" href="{{ url_for('home') }}">الرئيسية</a>
      {% if current_user.is_authenticated and current_user.id==user.id %}
        <a class="btn btn-accent" href="{{ url_for('settings') }}">إعدادات الحساب</a>
      {% endif %}
    </div>

    <div class="profile-header p-3 p-md-4">
      <div class="row g-3 align-items-center">
        <div class="col-auto">
          <img class="avatar"
               src="{{ url_for('static', filename='avatars/'+(user.avatar or 'default.png')) }}"
               alt="avatar">
        </div>

        <div class="col">
          <div class="d-flex flex-column text-start">
            <!-- الاسم المعروض كبير -->
            {% set disp = user.display_name or "" %}
            <div class="display-name mb-1">{{ disp or user.username }}</div>
            <!-- اليوزر بشارة تحت الاسم -->
            <div class="username-badge">@{{ user.username }}</div>

            {% if user.bio %}
              <div class="muted mt-2">{{ user.bio }}</div>
            {% endif %}
          </div>
        </div>

        {% if current_user.is_authenticated and current_user.id != user.id %}
        <div class="col-12 col-md-auto">
          {% if following %}
            <form method="post" action="{{ url_for('unfollow_user', username=user.username) }}">
              <button class="btn btn-outline-light fw-bold rounded-3">إلغاء المتابعة</button>
            </form>
          {% else %}
            <form method="post" action="{{ url_for('follow_user', username=user.username) }}">
              <button class="btn btn-accent rounded-3">متابعة</button>
            </form>
          {% endif %}
        </div>
        {% endif %}
      </div>

      <div class="d-flex flex-wrap gap-2 mt-3">
        <div class="chip">إعجابات معطاة: <b>{{ likes_given }}</b></div>
        <div class="chip">التعليقات: <b>{{ comments_count }}</b></div>
        <div class="chip">الصور المنشورة: <b>{{ photos|length }}</b></div>
      </div>
    </div>

    <div class="d-flex align-items-center gap-2 mt-4 mb-2">
      <h2 class="h5 section-title m-0">
        صور {{ (user.display_name or user.username) }}
      </h2>
    </div>

    {% if photos %}
      <div class="row g-3">
        {% for p in photos %}
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="photo-card h-100">
              <a href="{{ url_for('home') }}#photo-{{ p.id }}">
                <img src="{% if p.thumbname %}{{ url_for('static', filename='thumbs/'+p.thumbname) }}{% else %}{{ url_for('static', filename='uploads/'+p.filename) }}{% endif %}" alt="">
              </a>
              <div class="p-3">
                {% if p.description %}<div class="photo-desc">{{ p.description }}</div>{% endif %}
                <div class="d-flex justify-content-between mt-2 small muted">
                  <span>{{ p.likes or 0 }} إعجاب</span>
                  <span>{% if p.created_at %}{{ p.created_at.strftime('%Y/%m/%d %H:%M') }}{% else %}—{% endif %}</span>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center muted mt-4">لا توجد صور بعد.</div>
    {% endif %}
  </div>
</body>
</html>